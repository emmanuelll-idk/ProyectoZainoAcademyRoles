{% extends "profesores/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profesores/actividades_por_curso_materia.css' %}">
<link rel="icon" type="image/vnd.icon" href="{% static 'images/favicon/Favicon.png' %}">
{% endblock %}

{% block page_title %}Añadir Calificación{% endblock %}

{% block mockUp %}
<main class="main-content">
    <div class="content">
        <h2 class="section-title">
            Curso: {{ curso.Cur_nombre }} | {{ materia.Mtr_nombre }} | {{ actividad.Act_nombre }}
        </h2>

        <div class="seccion-actividades">
            <div class="seccion-header abiertas-header">
                <h3><i class="icon-edit"></i> Calificaciones de la Actividad</h3>
                <span class="contador">{{ entregas|length }}</span>
            </div>

                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
                {% endif %}

            <form method="post">
                {% csrf_token %}
                {% if entregas %}
                    <table class="calificaciones-table">
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Nombre Estudiante</th>
                                <th>Actividad</th>
                                <th>Archivos</th>
                                <th>Fecha límite</th>
                                <th>Estado</th>
                                <th>Calificación</th>
                                <th>Comentario</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entrega in entregas %}
                            <tr>
                                <td>
                                    {% if entrega.Est.Usuario_us.foto_perfil_usuario %}
                                        <img src="{{ entrega.Est.Usuario_us.foto_perfil_usuario.url }}" alt="Foto de {{ entrega.Est.Usuario_us.Us_nombre }}" class="foto-perfil">
                                    {% else %}
                                        <div class="foto-placeholder">
                                            {{ entrega.Est.Usuario_us.Us_nombre|first|upper }}
                                        </div>
                                    {% endif %}
                                </td>
                                <td>{{ entrega.Est }}</td>
                                <td>{{ actividad.Act_nombre }}</td>
                                <td>
                                    {% if entrega.archivos_lista %}
                                        <ul>
                                            {% for archivo in entrega.archivos_lista %}
                                                <li>
                                                    <a href="{{ archivo.archivo.url }}" target="_blank">
                                                        Ver archivo {{ forloop.counter }}
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p>Sin archivos</p>
                                    {% endif %}
                                </td>
                                <td>{{ actividad.Act_fechaLimite|date:"d/m/Y" }}</td>
                                <td>
                                    {% if not entrega.archivos_lista %}
                                        <span class="estado pendiente">Pendiente</span>
                                    {% elif entrega.Act_calificacion %}
                                        <span class="estado calificada">Calificada</span>
                                    {% elif entrega.retraso %}
                                        <span class="estado retraso">Con Retraso</span>
                                    {% else %}
                                        <span class="estado entregada">Entregada</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <input type="number" step="0.1" name="calificacion_{{ entrega.id }}"
                                        value="{{ entrega.Act_calificacion|default:'' }}"
                                        placeholder="Calificación" min="0" max="10"
                                        class="calificacion-input">
                                </td>
                                <td>
                                    <textarea name="comentario_{{ entrega.id }}" rows="2"
                                            placeholder="Escribe un comentario..."
                                            class="comentario-input">{{ entrega.Act_comentario }}</textarea>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <div class="empty-section">
                        <p><i class="icon-info"></i> No hay entregas registradas</p>
                    </div>
                {% endif %}

                <div class="acciones">
                    <a href="{% url 'lista_actividades_calificar' curso.Cur_id %}" class="btn-volver">Volver</a>
                    <button type="submit" class="btn-guardar">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</main>
{% endblock %}
