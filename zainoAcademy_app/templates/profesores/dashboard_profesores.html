{% extends "profesores/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profesores/dashboard_profesores.css' %}">
{% endblock %}

{% block mockUp %}
        <div class="dashboard-content">
            <!-- COLUMNA IZQUIERDA -->
            <div class="left-column">
                <!-- Tarjeta de Saludo -->
                <div class="greeting-card">
                    <div class="greeting-text">
                        <h2>Hola, {{ usuario.Us_nombre }}!</h2>
                        <p>Bienvenido a tu entorno virtual, recuerda estar atento <br> a las notificaciones y trabajos pendientes</p>
                        <a href="{% url 'actividad_profesores_consultar' %}" class="btn-leer-mas">Leer más</a>
                    </div>
                    <div class="greeting-illustration">
                        <img src="{% static 'images/profesores/lectura.png' %}" alt="Ilustración">
                    </div>
                </div>

                

                <!-- Notificaciones -->
                <!-- sección de actividades abiertas -->
                <div class="notifications-section">
                    <div class="notifications-header">
                        <h3>Actividades abiertas</h3>
                    </div>

                    <div class="notifications-table">
                        <div class="table-header">
                            <div class="col-header">Título</div>
                            <div class="col-header">Fecha límite</div>
                            <div class="col-header">Entregas</div>
                        </div>

                        {% for act in actividades_abiertas %}
                        <div class="table-row">
                            <div class="col-data">
                                <a href="{% url 'actividad_profesores_calificaciones' act.Act_id %}" class="activity-link">
                                    {{ act.Act_nombre }}
                                </a>
                            </div>
                            <div class="col-data">{{ act.Act_fechaLimite|date:"d/m/Y" }}</div>
                            <div class="col-data status-pendientes">• {{ act.total_entregas }} entregas</div>
                        </div>
                        {% empty %}
                        <div class="table-row">
                            <div class="col-data" style="grid-column: 1 / -1;">No tienes actividades abiertas en este momento</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

            </div>

            <!-- COLUMNA DERECHA -->
            <div class="right-column">
                <div class="calendar-section">
                    <div class="calendar-top">
                        <h4 id="calendar-month-year"></h4>
                        <div class="calendar-nav">
                            <button class="nav-btn prev-btn" onclick="changeMonth(-1)">‹</button>
                            <button class="nav-btn next-btn" onclick="changeMonth(1)">›</button>
                        </div>
                    </div>

                    <div class="calendar-widget">
                        <div class="calendar-grid" id="calendar-grid">
                            <div class="day-header">DO</div>
                            <div class="day-header">LU</div>
                            <div class="day-header">MA</div>
                            <div class="day-header">MI</div>
                            <div class="day-header">JU</div>
                            <div class="day-header">VI</div>
                            <div class="day-header">SA</div>
                        </div>
                    </div>
                </div>

                <!-- Perfil del Profesor -->
                <div class="student-profile">
                    <div class="student-avatar">
                        <a href="{% url 'ver_perfil_profesores' %}">
                        {% if usuario.foto_perfil_usuario %}
                            <img src="{{ usuario.foto_perfil_usuario.url }}" class="user-avatar" alt="Perfil">
                        {% else %}
                            <img src="{% static 'images/acudientes/perfil.png' %}" class="user-avatar" alt="Perfil">
                        {% endif %}
                    </a>
                    </div>
                    <h4 class="student-name">{{ usuario.Us_nombre }}</h4>
                    <p class="student-role">Profesor</p>
                
                        
                        <div class="info-row">
                            <span class="info-label">Estado</span>
                            <span class="info-value">Activo</span>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentDate = new Date();
        function renderCalendar(date) {
            const month = date.getMonth();
            const year = date.getFullYear();
            const monthYear = document.getElementById("calendar-month-year");
            const months = [
                "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
                "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
            ];
            monthYear.textContent = `${months[month]}, ${year}`;

            const calendarGrid = document.querySelector(".calendar-grid");
            calendarGrid.innerHTML = `
                <div class="day-header">DO</div>
                <div class="day-header">LU</div>
                <div class="day-header">MA</div>
                <div class="day-header">MI</div>
                <div class="day-header">JU</div>
                <div class="day-header">VI</div>
                <div class="day-header">SA</div>
            `;

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const prevLastDate = new Date(year, month, 0).getDate();

            for (let i = firstDay - 1; i >= 0; i--) {
                const dayCell = document.createElement("div");
                dayCell.classList.add("day-cell", "prev-month");
                dayCell.textContent = prevLastDate - i;
                calendarGrid.appendChild(dayCell);
            }

            let today = new Date();
            let formatter = new Intl.DateTimeFormat("es-CO", {
                timeZone: "America/Bogota",
                day: "numeric", month: "numeric", year: "numeric"
            });
            let parts = formatter.formatToParts(today);
            let todayDay = parseInt(parts.find(p => p.type === "day").value);
            let todayMonth = parseInt(parts.find(p => p.type === "month").value) - 1;
            let todayYear = parseInt(parts.find(p => p.type === "year").value);

            for (let i = 1; i <= lastDate; i++) {
                const dayCell = document.createElement("div");
                dayCell.classList.add("day-cell");
                dayCell.textContent = i;
                if (year === todayYear && month === todayMonth && i === todayDay) {
                    dayCell.classList.add("current-day");
                }
                calendarGrid.appendChild(dayCell);
            }
        }
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar(currentDate);
        }
        renderCalendar(currentDate);
    </script>
{% endblock %}