{% extends "profesores/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profesores/actividad_profesores_calificaciones.css' %}">
{% endblock %}

{% block mockUp %}
<main class="main-content">
    <header class="header">
        <h1>Calificando:</h1> <br>
        <span>{{ actividad.Act_nombre }}</span>
    </header>

    <h2 class="section-title">{{ actividad.Act_nombre }} para {{ actividad.Bol.Cur.Cur_nombre }}</h2>
    
    <div class="info-actividad">
        <p><strong>Fecha límite:</strong> {{ actividad.Act_fechaLimite|date:"d/m/Y" }}</p> <br>
        <p><strong>Descripción:</strong> {{ actividad.Act_descripcion }}</p>
    </div>

    <form method="post">
        {% csrf_token %}
        <table class="calificaciones-table">
            <thead>
                <tr>
                    <th>Nombre Estudiante</th>
                    <th>Estado</th>
                    <th>Archivo</th>
                    <th>Fecha Entrega</th>
                    <th>Calificación</th>
                </tr>
            </thead>
            <tbody>
                {% for entrega in entregas %}
                    <tr class="entrega-row {% if entrega.Esta_Actividad.Esta_Actividad_Estado == 'retrasada' %}retrasada{% elif entrega.Esta_Actividad.Esta_Actividad_Estado == 'no_entregada' %}no-entregada{% endif %}">
                        <td>{{ entrega.Est.Usuario_us.Us_nombre }}</td>
                        <td>
                            <span class="estado estado-{{ entrega.Esta_Actividad.Esta_Actividad_Estado }}">
                                {% if entrega.Esta_Actividad.Esta_Actividad_Estado == 'entregada' %}
                                    ✓ Entregada
                                {% elif entrega.Esta_Actividad.Esta_Actividad_Estado == 'retrasada' %}
                                    ⚠ Entrega tardía
                                {% elif entrega.Esta_Actividad.Esta_Actividad_Estado == 'no_entregada' %}
                                    ✗ No entregada
                                {% else %}
                                    ⏳ Pendiente
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            {% if entrega.Act_Archivo_Estudiante %}
                                <a href="{{ entrega.Act_Archivo_Estudiante.url }}" target="_blank" class="ver-archivo">Ver archivo</a>
                            {% else %}
                                <span class="sin-archivo">Sin archivo</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if entrega.Act_fecha_entrega %}
                                {{ entrega.Act_fecha_entrega|date:"d/m/Y" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if entrega.Esta_Actividad.Esta_Actividad_Estado != "pendiente" %}
                                <input type="number" 
                                       step="0.1" 
                                       min="0" 
                                       max="10"
                                       name="calificacion_{{ entrega.id }}" 
                                       value="{{ entrega.Act_calificacion|default:'' }}"
                                       class="calificacion-input">
                            {% else %}
                                <span>No calificable</span>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5">No hay estudiantes registrados para esta actividad.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="acciones">
            <a href="{% url 'lista_actividades_calificar' actividad.Bol.Cur.Cur_id %}" class="volver-btn">Volver</a>
            <button type="submit" class="guardar-btn">Guardar Calificaciones</button>
        </div>
    </form>
</main>
{% endblock %}