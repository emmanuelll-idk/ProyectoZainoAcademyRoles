{% extends "profesores/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profesores/materialApoyo_editar.css' %}">
<link rel="icon" type="image/vnd.icon" href="{% static 'images/favicon/Favicon.png' %}">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
{% endblock %}

{% block page_title %}Material de Apoyo{% endblock %}

{% block mockUp %}
    {% if messages %}
        {% for message in messages %}
            <div class="floating-alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="content">
        <!-- FORMULARIO PARA EDITAR MATERIAL -->
        <form method="POST" enctype="multipart/form-data" action="{% url 'materialApoyo_editar' material.Mate_id %}">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="titulo">Título del material:</label>
                <input type="text" id="titulo" name="Mate_titulo" value="{{ material.Mate_titulo }}" required>
            </div>
            
            <div class="form-group">
                <label for="descripcion">Descripción:</label>
                <textarea id="descripcion" name="Mate_descripcion" rows="3" required>{{ material.Mate_descripcion }}</textarea>
            </div>

            <!-- Fecha de creación (solo lectura, si existe en tu modelo) -->
            {% if material.Mate_fechaCreacion %}
            <div class="form-group">
                <label for="fecha_creacion">Fecha de creación:</label>
                <div class="fecha-info">
                    <input type="text" id="fecha_creacion" readonly 
                           value="{{ material.Mate_fechaCreacion|date:'d/m/Y' }}" class="fecha-readonly">
                </div>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label for="archivo">Archivo:</label>
                <input type="file" id="archivo" name="Mate_archivo">
                {% if material.Mate_archivo %}
                    <div class="archivo-actual">
                        <p>Archivo actual: 
                            <a href="{{ material.Mate_archivo.url }}" target="_blank">
                                {{ material.Mate_archivo.name }}
                            </a>
                        </p>
                        <small>Deja este campo vacío si no quieres cambiar el archivo</small>
                    </div>
                {% endif %}
            </div>

            <div class="form-actions">
                <!-- Volver a la lista de materiales -->
                <a href="{% url 'materialApoyo_subir' boletin.Bol_id%}" class="volver-btn">Volver</a>
                <button type="submit" class="crear-btn">Actualizar material</button>
            </div>
        </form>
    </div>

    <!-- Modal de confirmación para eliminar -->
    <div id="deleteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>¿Estás seguro?</h3>
            <p>Esta acción no se puede deshacer. ¿Quieres eliminar este material?</p>
            <div class="modal-actions">
                <button onclick="closeDeleteModal()" class="cancel-btn">Cancelar</button>
                <button onclick="confirmDelete()" class="delete-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <script>
        let materialIdToDelete = null;

        function editarMaterial(materialId) {
            window.location.href = "{% url 'materialApoyo_editar' 0 %}".replace('0', materialId);
        }

        function borrarMaterial(materialId) {
            materialIdToDelete = materialId;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            materialIdToDelete = null;
        }

        function confirmDelete() {
            if (materialIdToDelete) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'materialApoyo_eliminar' 0 %}".replace('0', materialIdToDelete);
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
{% endblock %}
