<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Material de Apoyo - Zaino Academy</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/profesores/materialApoyo_editar.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:400,600,700&display=swap" rel="stylesheet"/>
</head>
<body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="logo">
            <img src="{% static 'images/profesores/Favicon.png' %}" alt="Logo Libro"/>
            <img src="{% static 'images/profesores/LogoNormal-removebg-preview.png' %}" alt="Logo Zaino Academy" />
        </div>
        <nav>
            <ul class="nav-list">
                <li><a href="{% url 'dashboard_profesores' %}" class="nav-item active">
                    <img src="{% static 'images/profesores/inicio.png' %}" class="nav-icon" alt="Inicio">
                    Inicio
                </a></li>

                <li><a href="{% url 'actividad_profesores_consultar' %}" class="nav-item">
                    <img src="{% static 'images/profesores/actividades.png' %}" class="nav-icon" alt="Actividades"> 
                    Actividades - Material de apoyo
                </a></li>

                <li><a href="{% url 'asistencia_profesores_cursos' %}" class="nav-item">
                    <img src="{% static 'images/profesores/asistencia.png' %}" class="nav-icon" alt="Asistencia"> 
                    Asistencia
                </a></li>

                <li><a href="{% url 'reportes_profesores' %}" class="nav-item">
                    <img src="{% static 'images/profesores/reportes.png' %}" class="nav-icon" alt="Reportes"> 
                    Reportes
                </a></li>
            </ul>
        </nav>
        <div class="logout-container">
            <form method="POST" action="{% url 'login' %}">
                {% csrf_token %}
                <button type="button" class="logout-btn" onclick="openModal()">Cerrar sesión</button>
            </form>
        </div>
    </aside>
    
    <main class="main-content">
        <!-- HEADER -->
        <header class="header">
            <h1 class="page-title">Material de apoyo:</h1>
            <div class="header-right">
                <a href="{% url 'notificaciones_profesores' %}">
                    <img src="{% static 'images/profesores/notificaciones.png' %}" class="notification-icon" alt="Notificaciones">
                </a>
                <div class="user-info">
                    <span class="user-name">{{ usuario.Us_nombre }}</span>
                    <a href="#">
                        <img src="{% static 'images/profesores/avatarMujer.png' %}" class="user-avatar" alt="Perfil">
                    </a>
                </div>
            </div>
        </header>

        <div class="content">
            <h2 class="section-title">Editar material de apoyo:</h2>
            
            <!-- FORMULARIO PARA EDITAR MATERIAL -->
            <form method="POST" enctype="multipart/form-data" action="{% url 'materialApoyo_editar' material.Mate_id %}">
                {% csrf_token %}
                
                <div class="form-group">
                    <label for="titulo">Título del material:</label>
                    <input type="text" id="titulo" name="Mate_titulo" value="{{ material.Mate_titulo }}" required>
                </div>
                
                <div class="form-group">
                    <label for="descripcion">Descripción:</label>
                    <textarea id="descripcion" name="Mate_descripcion" rows="3" required>{{ material.Mate_descripcion }}</textarea>
                </div>

                <!-- CAMPO: Fecha de creación (solo lectura, si existe en tu modelo) -->
                {% if material.Mate_fechaCreacion %}
                <div class="form-group">
                    <label for="fecha_creacion">Fecha de creación:</label>
                    <div class="fecha-info">
                        <input type="text" id="fecha_creacion" name="fecha_creacion" readonly 
                               value="{{ material.Mate_fechaCreacion|date:'d/m/Y' }}" class="fecha-readonly">
                    </div>
                </div>
                {% endif %}
                
                <div class="form-group">
                    <label for="archivo">Archivo:</label>
                    <input type="file" id="archivo" name="Mate_archivo">
                    {% if material.Mate_archivo %}
                        <div class="archivo-actual">
                            <p>Archivo actual: <a href="{{ material.Mate_archivo.url }}" target="_blank">{{ material.Mate_archivo.name }}</a></p>
                            <small>Deja este campo vacío si no quieres cambiar el archivo</small>
                        </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <!-- Volver a la lista de materiales -->
                    <a href="{% url 'materialApoyo_consultar' boletin.Bol_id %}" class="volver-btn">Volver</a>
                    <button type="submit" class="crear-btn">Actualizar material</button>
                </div>
            </form>
        </div>
    </main>

    <!-- Modal de confirmación para eliminar -->
    <div id="deleteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>¿Estás seguro?</h3>
            <p>Esta acción no se puede deshacer. ¿Quieres eliminar este material?</p>
            <div class="modal-actions">
                <button onclick="closeDeleteModal()" class="cancel-btn">Cancelar</button>
                <button onclick="confirmDelete()" class="delete-btn">Eliminar</button>
            </div>
        </div>
    </div>

    <script>
        let materialIdToDelete = null;

        function editarMaterial(materialId) {
            window.location.href = "{% url 'materialApoyo_editar' 0 %}".replace('0', materialId);
        }

        function borrarMaterial(materialId) {
            materialIdToDelete = materialId;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            materialIdToDelete = null;
        }

        function confirmDelete() {
            if (materialIdToDelete) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'materialApoyo_eliminar' 0 %}".replace('0', materialIdToDelete);
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>
