<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Acudiente - Zaino Academy</title>
    <link rel="stylesheet" href="{% static 'css/acudientes/dashboard_acudientes.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:400,600,700&display=swap" rel="stylesheet" />
</head>
<body class="dashboard-page">
    <aside class="sidebar">
        <div class="logo">
            <a href="{% url 'dashboard_acudientes' %}">
                <img src="{% static 'images/acudientes/Favicon.png' %}" alt="Logo Libro"/>
            </a>
            <a href="{% url 'dashboard_acudientes' %}">
                <img src="{% static 'images/acudientes/LogoNormal-removebg-preview.png' %}" alt="Logo Zaino Academy" />
            </a>
        </div>
        <nav>
            <ul class="nav-list">
                <li><a href="{% url 'dashboard_acudientes' %}" class="nav-item active">
                    <img src="{% static 'images/acudientes/inicio.png' %}" class="nav-icon" alt="Inicio"> Inicio
                </a></li>
                <li><a href="{% url 'actividades_acudientes' %}" class="nav-item">
                    <img src="{% static 'images/acudientes/actividades.png' %}" class="nav-icon" alt="Actividades"> Actividades
                </a></li>
                <li><a href="{% url 'asistencia_acudientes' %}" class="nav-item">
                    <img src="{% static 'images/acudientes/asistencia.png' %}" class="nav-icon" alt="Asistencia"> Asistencia
                </a></li>
            </ul>
        </nav>
        <div class="logout-container">
            <form method="POST" action="{% url 'login' %}">
                {% csrf_token %}
                <button type="button" class="logout-btn" onclick="openModal()">Cerrar sesión</button>
            </form>
        </div>
    </aside>
    
    <main class="main-content">
        <header class="page-header">
            <div class="header-icons">
                <span class="user-name">{{ usuario.Us_nombre }}</span>
                <a href="{% url 'ver_perfil_acudientes' %}">
                    <img src="{% static 'images/acudientes/perfil.png' %}" class="user-avatar" alt="Perfil">
                </a>
            </div>
            <button class="hamburger" onclick="toggleMenu()">☰</button>
                
            <div id="dropdown-menu" class="dropdown-menu">
                <a href="{% url 'dashboard_acudientes' %}">Inicio</a>
                <a href="{% url 'actividades_acudientes' %}">Actividades</a>
                <a href="{% url 'asistencia_acudientes' %}">Asistencia</a>
                <form method="POST" action="{% url 'login' %}">
                    {% csrf_token %}
                    <button type="button" class="dropdown-logout-btn" onclick="openModal()">Cerrar sesión</button>
                </form>
            </div>
        </header>

        <div class="dashboard-content">
            <!-- IZQUIERDA -->
            <div class="left-column">
                <div class="greeting-card">
                    <div class="greeting-text">
                        <h2>Hola, {{ usuario.Us_nombre }}!</h2>
                        <p>Bienvenido a tu entorno virtual, recuerda estar atento a las notificaciones y trabajos pendientes de tu estudiante.</p>
                        <a href="{% url 'actividades_acudientes' %}" class="btn-leer-mas">Leer más</a>
                    </div>
                    <div class="greeting-illustration">
                        <img src="{% static 'images/acudientes/lectura.png' %}" class="greeting-illustration" alt="Lectura">
                    </div>
                </div>

                <!-- Notificaciones -->
                <div class="notifications-section">
                    <div class="notifications-header">
                        <h3>Notificaciones</h3>
                        <a href="{% url 'notificaciones_acudientes' %}" class="ver-todo-btn">Ver todo</a>
                    </div>
                    
                    <div class="notifications-table">
                        <div class="table-header">
                            <div class="col-header">ACTIVIDAD</div>
                            <div class="col-header">MATERIA</div>
                            <div class="col-header">ESTUDIANTE</div>
                            <div class="col-header">ESTADO</div>
                        </div>

                        {% if pendientes and pendientes|length > 0 %}
                            {% for p in pendientes %}
                            <div class="table-row">
                                <div class="col-data">{{ p.actividad }}</div>
                                <div class="col-data">{{ p.materia }}</div>
                                <div class="col-data">{{ p.estudiante }}</div>
                                <div class="col-data status-pendiente">{{ p.estado }}</div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="table-row">
                                <div class="col-data" colspan="4">
                                    No hay actividades pendientes
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- DERECHA -->
            <div class="right-column">
                <div class="calendar-section">
                    <div class="calendar-top">
                        <h4 id="calendar-month-year"></h4>
                        <div class="calendar-nav">
                            <button class="nav-btn prev-btn" onclick="changeMonth(-1)">‹</button>
                            <button class="nav-btn next-btn" onclick="changeMonth(1)">›</button>
                        </div>
                    </div>
                    <div class="calendar-widget">
                        <div class="calendar-grid" id="calendar-grid">
                            <div class="day-header">DO</div>
                            <div class="day-header">LU</div>
                            <div class="day-header">MA</div>
                            <div class="day-header">MI</div>
                            <div class="day-header">JU</div>
                            <div class="day-header">VI</div>
                            <div class="day-header">SA</div>
                        </div>
                    </div>
                </div>

                <!-- Perfil -->
                <div class="acudient-profile">
                    <div class="acudient-avatar">
                        <img src="{% static 'images/acudientes/perfil.png' %}" alt="Perfil" class="avatar-img">
                    </div>
                    <h4 class="acudient-name">{{ usuario.Us_nombre }}</h4>
                    <p class="acudient-role">Acudiente</p>
                    <div class="acudient-info">
                        <div class="info-row">
                            <span class="info-label">Estado</span>
                            <span class="info-value">Activo</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Fecha registro</span>
                            <span class="info-value">{{ usuario.fecha_registro }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Pendientes</span>
                            <span class="info-value pending-count">
                                {{ pendientes|length }} pendientes
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Modal logout -->
    <div id="logout-modal" class="modal">
        <div class="modal-content">
            <h2>¿Cerrar Sesión?</h2>
            <div class="modal-actions">
                <form method="POST" action="{% url 'login' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn-confirm">Confirmar</button>
                </form>
                <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
    function toggleMenu() {
        const menu = document.getElementById("dropdown-menu");
        menu.classList.toggle("show");
    }
    const modal = document.getElementById('logout-modal');
    function openModal() { modal.style.display = 'flex'; }
    function closeModal() { modal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == modal) { closeModal(); } }
    </script>

    <script>
        let currentDate = new Date();
        function renderCalendar(date) {
            const month = date.getMonth();
            const year = date.getFullYear();
            const monthYear = document.getElementById("calendar-month-year");
            const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
            monthYear.textContent = `${months[month]}, ${year}`;

            const calendarGrid = document.querySelector(".calendar-grid");
            calendarGrid.innerHTML = `
                <div class="day-header">DO</div>
                <div class="day-header">LU</div>
                <div class="day-header">MA</div>
                <div class="day-header">MI</div>
                <div class="day-header">JU</div>
                <div class="day-header">VI</div>
                <div class="day-header">SA</div>
            `;

            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const prevLastDate = new Date(year, month, 0).getDate();

            for (let i = firstDay - 1; i >= 0; i--) {
                const dayCell = document.createElement("div");
                dayCell.classList.add("day-cell", "prev-month");
                dayCell.textContent = prevLastDate - i;
                calendarGrid.appendChild(dayCell);
            }

            let today = new Date();
            for (let i = 1; i <= lastDate; i++) {
                const dayCell = document.createElement("div");
                dayCell.classList.add("day-cell");
                dayCell.textContent = i;
                if (year === today.getFullYear() && month === today.getMonth() && i === today.getDate()) {
                    dayCell.classList.add("current-day");
                }
                calendarGrid.appendChild(dayCell);
            }
        }
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar(currentDate);
        }
        renderCalendar(currentDate);
    </script>

</body>
</html>
