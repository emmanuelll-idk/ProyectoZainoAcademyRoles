{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contraseña - Zaino Academy</title>
    <link rel="stylesheet" href="{% static 'css/registration/registration.css' %}">
    <link rel="icon" type="image/vnd.icon" href="{% static 'images/favicon/Favicon.png' %}">
</head>
<body class="login-page">
    <div class="login-wrapper">

        <div class="login-left">

            <div class="login-logo">
                <a href="{% url 'home' %}" class="logo-button">
                    <img src="{% static 'images/registration/LogoNormal-removebg-preview.png' %}" 
                        alt="Logo Zaino Academy">
                </a>
            </div>

            <div class="login-card">
                <h1><b>Recuperar <span>Contraseña</span></b></h1>

                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                        <div class="message {{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
                {% endif %}

                {% if exito %}
                <div class="messages">
                    <div style="text-align:center; margin-top:15px;">
                        <a href="{% url 'login' %}" class="btn-login" style="width:auto; padding:10px 20px;">Volver al login</a>
                    </div>
                </div>
                {% else %}
                <p style="margin-bottom: 15px; font-weight: bold; color: #4a90e2;">Tipo de usuario: {{ tipo_usuario_obj.TusTiposUsuario }}</p>

                <form method="POST" class="login-form">
                    {% csrf_token %}

                    {% if tipo_usuario == "estudiante" %}
                        <!-- Formulario para estudiantes -->
                        <div class="info-box" style="padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                            <p style="margin: 0; font-size: 14px; color: #4a90e2;">
                                Si no cuenta con los datos de su acudiente, pida el cambio de contraseña a su institución.
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="correo_acudiente"><b>Correo del Acudiente</b></label><br>
                            <input type="email" name="correo_acudiente" id="correo_acudiente" required 
                                   placeholder="correo@acudiente.com" class="form-control">
                        </div><br>

                        <div class="form-group">
                            <label for="documento_acudiente"><b>Documento del Acudiente</b></label><br>
                            <input type="text" name="documento_acudiente" id="documento_acudiente" required 
                                   placeholder="Documento del acudiente" class="form-control">
                        </div><br>

                        <div class="form-group">
                            <label for="documento_estudiante"><b>Documento del Estudiante</b></label><br>
                            <input type="text" name="documento_estudiante" id="documento_estudiante" required 
                                   placeholder="Documento del estudiante" class="form-control">
                        </div><br>

                    {% else %}
                        <!-- Formulario para profesores, acudientes y directivos -->
                        <div class="form-group">
                            <label for="correo"><b>Tu Correo</b></label><br>
                            <input type="email" name="correo" id="correo" required 
                                   placeholder="tu@correo.com" class="form-control">
                        </div><br>

                        <div class="form-group">
                            <label for="documento"><b>Tu Documento</b></label><br>
                            <input type="text" name="documento" id="documento" required 
                                   placeholder="Tu documento de identidad" class="form-control">
                        </div><br>
                    {% endif %}

                    <div class="form-group password-wrapper">
                        <label for="new_password"><b>Nueva Contraseña</b></label><br>
                        <input type="password" name="new_password" id="new_password" required 
                               placeholder="•••••••" class="form-control" minlength="3">
                        <span class="toggle-password" onclick="togglePassword('new_password')">(•)</span>
                    </div><br>

                    <div class="form-group password-wrapper">
                        <label for="confirm_password"><b>Confirmar Contraseña</b></label><br>
                        <input type="password" name="confirm_password" id="confirm_password" required 
                               placeholder="•••••••" class="form-control" minlength="3">
                        <span class="toggle-password" onclick="togglePassword('confirm_password')">(•)</span>
                    </div><br>



                    <button type="submit" class="btn-login"><b>Cambiar Contraseña</b></button> 
                    <br>
                    <small><a href="{% url 'reset_password_step1' %}"><b class="volver">Cambiar tipo de usuario</b></a></small>
                </form>
                {% endif %}
            </div>
        </div>

        <div class="login-decor">
            <img src="{% static 'images/registration/figuras.png' %}" alt="Decoración figuras">
        </div>
    </div>
</body>

<script>
function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
}

// Validación en tiempo real de contraseñas
document.getElementById('confirm_password')?.addEventListener('input', function() {
    const password = document.getElementById('new_password').value;
    const confirm = this.value;
    
    if (confirm && password !== confirm) {
        this.style.borderColor = '#dc3545';
    } else {
        this.style.borderColor = '#ddd';
    }
});

// Validación de longitud mínima
document.getElementById('new_password')?.addEventListener('input', function() {
    const password = this.value;
    
    if (password && password.length < 3) {
        this.style.borderColor = '#ffc107';
    } else {
        this.style.borderColor = '#ddd';
    }
});
</script>

</html>